var Framer={countTicks:360,frequencyData:[],tickSize:10,PI:360,index:0,loadingAngle:0,audioMultLvl:1,init:function(t){this.canvas=document.querySelector("canvas"),this.scene=t,this.context=t.context,this.configure()},configure:function(){this.maxTickSize=9*this.tickSize*this.scene.scaleCoef,this.countTicks=360*Scene.scaleCoef},draw:function(){this.drawTicks(),this.drawEdging()},drawTicks:function(){this.context.save(),this.context.beginPath(),this.context.lineWidth=1,this.ticks=this.getTicks(this.countTicks,this.tickSize,[0,90]);for(var t=0,e=this.ticks.length;t<e;++t){var i=this.ticks[t];this.drawTick(i.x1,i.y1,i.x2,i.y2)}this.context.restore()},drawTick:function(t,e,i,n){var s=parseInt(this.scene.cx+t),a=parseInt(this.scene.cy+e),r=parseInt(this.scene.cx+i),c=parseInt(this.scene.cy+n),o=this.context.createLinearGradient(s,a,r,c);o.addColorStop(0,"rgb(0, 0, 0, 0)"),o.addColorStop(.6,"#FFFFFF"),o.addColorStop(1,"#A4A4A4"),this.context.beginPath(),this.context.strokeStyle=o,this.context.lineWidth=2,this.context.moveTo(this.scene.cx+t,this.scene.cx+e),this.context.lineTo(this.scene.cx+i,this.scene.cx+n),this.context.stroke()},setLoadingPercent:function(t){this.loadingAngle=2*t*Math.PI},drawEdging:function(){this.context.save(),this.context.beginPath(),this.context.strokeStyle="rgb(0, 0, 0)",this.context.lineWidth=2;var t=Tracker.lineWidth/2;this.context.moveTo(this.scene.padding+2*this.scene.radius-Tracker.innerDelta-t,this.scene.padding+this.scene.radius),this.context.arc(this.scene.cx,this.scene.cy,this.scene.radius-Tracker.innerDelta-t,0,this.loadingAngle,!1),this.context.stroke(),this.context.restore()},getTicks:function(t,e,i){for(var n,s,a,r,c,o,h=this.getTickPoitns(t),u=[],d=[],l=0,g=h.length;l<g;++l){var f=1-l/(2.5*g),x=((this.frequencyData[l]*this.audioMultLvl||0)-160*f)*this.scene.scaleCoef;if(x<0&&(x=0),c=h[l],o=i[0]<=c.angle&&c.angle<=i[1]?this.scene.radius/(this.scene.radius-this.getSize(c.angle,i[0],i[1])-x):this.scene.radius/(this.scene.radius-(10+x)),a=(n=c.x*(this.scene.radius-10))*o,r=(s=c.y*(this.scene.radius-10))*o,u.push({x1:n,y1:s,x2:a,y2:r}),l<20){var p=x/50;p=p<1?1:p,d.push(p)}}var m=d.reduce(function(t,e){return t+e},0)/d.length;return this.canvas.style.transform="scale("+m+")",u},getSize:function(t,e,i){var n,s=(i-e)/2,a=t-e;if(a==s)return this.maxTickSize;var r=Math.abs(s-a),c=70*Math.sqrt(1/r);return n=c>this.maxTickSize?this.maxTickSize-r:Math.max(this.tickSize,c),this.index>this.count&&(this.index=0),n},getTickPoitns:function(t){for(var e=[],i=this.PI/t,n=0;n<this.PI;n+=i){var s=n*Math.PI/(this.PI/2);e.push({x:Math.cos(s),y:-Math.sin(s),angle:n})}return e}},Tracker={innerDelta:20,lineWidth:7,prevAngle:.5,angle:0,animationCount:10,pressButton:!1,init:function(t){this.scene=t,this.context=t.context,this.initHandlers()},initHandlers:function(){var t=this;this.scene.canvas.addEventListener("mousedown",function(e){t.isInsideOfSmallCircle(e)||t.isOusideOfBigCircle(e)||(t.prevAngle=t.angle,t.pressButton=!0,t.stopAnimation(),t.calculateAngle(e,!0))}),window.addEventListener("mouseup",function(){if(t.pressButton)var e=setInterval(function(){t.animatedInProgress||(t.pressButton=!1,Player.context.currentTime=t.angle/(2*Math.PI)*Player.source.buffer.duration,clearInterval(e))},100)}),window.addEventListener("mousemove",function(e){t.animatedInProgress||t.pressButton&&t.scene.inProcess()&&t.calculateAngle(e)})},isInsideOfSmallCircle:function(t){var e=Math.abs(t.pageX-this.scene.cx-this.scene.coord.left),i=Math.abs(t.pageY-this.scene.cy-this.scene.coord.top);return Math.sqrt(e*e+i*i)<this.scene.radius-3*this.innerDelta},isOusideOfBigCircle:function(t){return Math.abs(t.pageX-this.scene.cx-this.scene.coord.left)>this.scene.radius||Math.abs(t.pageY-this.scene.cy-this.scene.coord.top)>this.scene.radius},draw:function(){Player.source.buffer&&(this.pressButton||(this.angle=Player.context.currentTime/Player.source.buffer.duration*2*Math.PI||0),this.drawArc())},drawArc:function(){this.context.save(),this.context.strokeStyle="rgba(255, 255, 255, 0.616)",this.context.beginPath(),this.context.lineWidth=this.lineWidth,this.r=this.scene.radius-(this.innerDelta+this.lineWidth/2),this.context.arc(this.scene.radius+this.scene.padding,this.scene.radius+this.scene.padding,this.r,0,this.angle,!1),this.context.stroke(),this.context.restore()},calculateAngle:function(t,e){this.animatedInProgress=e,this.mx=t.pageX,this.my=t.pageY,this.angle=Math.atan((this.my-this.scene.cy-this.scene.coord.top)/(this.mx-this.scene.cx-this.scene.coord.left)),this.mx<this.scene.cx+this.scene.coord.left&&(this.angle=Math.PI+this.angle),this.angle<0&&(this.angle+=2*Math.PI),e?this.startAnimation():this.prevAngle=this.angle},startAnimation:function(){var t=this,e=this.angle,i=(Math.abs(this.angle)-Math.abs(this.prevAngle))/this.animationCount,n=0,s=function(){t.angle+=i,++n==t.animationCount?(t.angle=e,t.prevAngle=e,t.animatedInProgress=!1):t.animateId=setTimeout(s,20)};this.angle=this.prevAngle,this.animateId=setTimeout(s,20)},stopAnimation:function(){clearTimeout(this.animateId),this.animatedInProgress=!1}},Scene={padding:120,minSize:740,optimiseHeight:982,_inProcess:!1,init:function(){this.canvasConfigure(),this.initHandlers(),Framer.init(this),Tracker.init(this),Controls.init(this),this.startRender()},canvasConfigure:function(){this.canvas=document.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.context.strokeStyle="#FFFFFF",this.calculateSize()},calculateSize:function(){this.scaleCoef=Math.max(.5,740/this.optimiseHeight);var t=Math.max(this.minSize,1);this.canvas.setAttribute("width",t),this.canvas.setAttribute("height",t),this.width=t,this.height=t,this.radius=(t-2*this.padding)/2,this.cx=this.radius+this.padding,this.cy=this.radius+this.padding,this.coord=this.canvas.getBoundingClientRect()},initHandlers:function(){var t=this;window.onresize=function(){t.canvasConfigure(),Framer.configure(),t.render()}},render:function(){var t=this;requestAnimationFrame(function(){t.clear(),t.draw(),t._inProcess&&t.render()})},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(){Framer.draw(),Tracker.draw(),Controls.draw()},startRender:function(){this._inProcess=!0,this.render()},stopRender:function(){this._inProcess=!1},inProcess:function(){return this._inProcess}},Controls={playing:!1,init:function(t){this.scene=t,this.context=t.context,this.initHandlers(),this.timeControl=document.querySelector(".time")},initHandlers:function(){this.initPlayButton(),this.initPauseButton(),this.initAudioSlider(),this.initPrevSongButton(),this.initNextSongButton(),this.initTimeHandler()},initPlayButton:function(){var t=this;this.playButton=document.querySelector(".play"),this.playButton.addEventListener("mouseup",function(){t.playButton.style.display="none",t.pauseButton.style.display="inline-block",Player.play(),t.playing=!0})},initPauseButton:function(){var t=this;this.pauseButton=document.querySelector(".pause"),this.pauseButton.addEventListener("mouseup",function(){t.playButton.style.display="inline-block",t.pauseButton.style.display="none",Player.pause(),t.playing=!1})},initAudioSlider:function(){const t=document.getElementById("volumeSelector");Player.gainNode.gain.value=t.value/100,Framer.audioMultLvl=(1-t.value/100)/2.5+1,t.oninput=function(){Player.gainNode.gain.value=this.value/100,Framer.audioMultLvl=(1-t.value/100)/2.5+1}},initPrevSongButton:function(){var t=this;this.prevSongButton=document.querySelector(".prevSong"),this.prevSongButton.addEventListener("mouseup",function(){Player.prevTrack(),t.playing&&Player.play()})},initNextSongButton:function(){var t=this;this.nextSongButton=document.querySelector(".nextSong"),this.nextSongButton.addEventListener("mouseup",function(){Player.nextTrack(),t.playing&&Player.play()})},initTimeHandler:function(){var t=this;setTimeout(function(){var e=parseInt(Player.context.currentTime||0),i=parseInt(e/60),n=e-60*i;i<10&&(i="0"+i),n<10&&(n="0"+n);var s=i+":"+n;t.timeControl.textContent=s,t.initTimeHandler()},300)},draw:function(){this.drawPic()},drawPic:function(){this.context.save(),this.context.beginPath(),this.context.fillStyle="rgb(0, 0, 0, 0)",this.context.lineWidth=1;var t=Tracker.r/Math.sqrt(Math.pow(Math.tan(Tracker.angle),2)+1),e=Math.sqrt(Tracker.r*Tracker.r-t*t);2==this.getQuadrant()&&(t=-t),3==this.getQuadrant()&&(t=-t,e=-e),4==this.getQuadrant()&&(e=-e),this.context.arc(this.scene.radius+this.scene.padding+t,this.scene.radius+this.scene.padding+e,10,0,2*Math.PI,!1),this.context.fill(),this.context.restore()},getQuadrant:function(){return 0<=Tracker.angle&&Tracker.angle<Math.PI/2?1:Math.PI/2<=Tracker.angle&&Tracker.angle<Math.PI?2:Math.PI<Tracker.angle&&Tracker.angle<3*Math.PI/2?3:3*Math.PI/2<=Tracker.angle&&Tracker.angle<=2*Math.PI?4:void 0}},Player={buffer:null,duration:0,tracks:[{artist:"Nihilore",song:"Artifice",src:"../../media/Artifice.mp3"}],init:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext,this.context.suspend&&this.context.suspend(),this.firstLaunch=!0;try{this.javascriptNode=this.context.createScriptProcessor(2048,1,1),this.javascriptNode.connect(this.context.destination),this.analyser=this.context.createAnalyser(),this.analyser.connect(this.javascriptNode),this.analyser.smoothingTimeConstant=.6,this.analyser.fftSize=2048,this.source=this.context.createBufferSource(),this.destination=this.context.destination,this.loadTrack(0),this.gainNode=this.context.createGain(),this.source.connect(this.gainNode),this.gainNode.connect(this.analyser),this.gainNode.connect(this.destination),this.initHandlers()}catch(t){Framer.setLoadingPercent(1)}Framer.setLoadingPercent(1),Scene.init()},loadTrack:function(t){var e=this,i=new XMLHttpRequest,n=this.tracks[t];document.querySelector(".song .artist").textContent=n.artist,document.querySelector(".song .name").textContent=n.song,this.currentSongIndex=t,i.open("GET",n.src,!0),i.responseType="arraybuffer",i.onload=function(){e.context.decodeAudioData(i.response,function(t){e.source.buffer=t})},i.send()},nextTrack:function(){},prevTrack:function(){},play:function(){this.context.resume&&this.context.resume(),this.firstLaunch&&(this.source.start(),this.firstLaunch=!1)},stop:function(){this.context.currentTime=0,this.context.suspend()},pause:function(){this.context.suspend()},mute:function(){this.gainNode.gain.value=0},unmute:function(){this.gainNode.gain.value=1},initHandlers:function(){var t=this;this.javascriptNode.onaudioprocess=function(){Framer.frequencyData=new Uint8Array(t.analyser.frequencyBinCount),t.analyser.getByteFrequencyData(Framer.frequencyData)}}};Player.init();